<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of DisplayCorrectionEffect</title>
  <meta name="keywords" content="DisplayCorrectionEffect">
  <meta name="description" content="[d0,de,dc]=DisplayCorrectionEffect(...">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../../index.html">Home</a> &gt;  <a href="../../../../index.html">atmat</a> &gt; <a href="../../../index.html">pubtools</a> &gt; <a href="../../index.html">LatticeTuningFunctions</a> &gt; <a href="../index.html">correction</a> &gt; <a href="index.html">correction_chain</a> &gt; DisplayCorrectionEffect.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../../index.html"><img alt="<" border="0" src="../../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for atmat/pubtools/LatticeTuningFunctions/correction/correction_chain&nbsp;<img alt=">" border="0" src="../../../../../right.png"></a></td></tr></table>-->

<h1>DisplayCorrectionEffect
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>[d0,de,dc]=DisplayCorrectionEffect(...</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function [d0,de,dc]=DisplayCorrectionEffect(r0,rerr,rcor,inCODe,inCODc,refpts,indHCor,indVCor,indQCor,indSCor) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [d0,de,dc]=DisplayCorrectionEffect(...
     r0,...        1) reference lattice
     rerr,...      2) lattice with errors
     rcor,...      3) corrected lattice
     inCODe,...    4) initial COD guess for rerr
     inCODc,...    5) initial COD guess for rcor
     refpts,...    6) reference points for computation
     indHCor,...   7) hor. steerers indexes
     indVCor,...   8) ver. steerers indexes 
     indQCor,...   9) normal quad. correctors indexes
     indSCor)     10) skew quad. correctors indexes

 dispaly correction effect.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="CorrectionChain.html" class="code" title="function [rcor,...            % corrected lattice">CorrectionChain</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function a=getdatalattice(r0,inCOD,refpts,indHCor,indVCor,indCorQuads,indSCor,emitok)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [d0,de,dc]=DisplayCorrectionEffect(</a><span class="keyword">...</span>
0002     r0,<span class="keyword">...</span>
0003     rerr,<span class="keyword">...</span>
0004     rcor,<span class="keyword">...</span>
0005     inCODe,<span class="keyword">...</span>
0006     inCODc,<span class="keyword">...</span>
0007     refpts,<span class="keyword">...</span>
0008     indHCor,<span class="keyword">...</span>
0009     indVCor,<span class="keyword">...</span>
0010     indQCor,<span class="keyword">...</span>
0011     indSCor)
0012 <span class="comment">% [d0,de,dc]=DisplayCorrectionEffect(...</span>
0013 <span class="comment">%     r0,...        1) reference lattice</span>
0014 <span class="comment">%     rerr,...      2) lattice with errors</span>
0015 <span class="comment">%     rcor,...      3) corrected lattice</span>
0016 <span class="comment">%     inCODe,...    4) initial COD guess for rerr</span>
0017 <span class="comment">%     inCODc,...    5) initial COD guess for rcor</span>
0018 <span class="comment">%     refpts,...    6) reference points for computation</span>
0019 <span class="comment">%     indHCor,...   7) hor. steerers indexes</span>
0020 <span class="comment">%     indVCor,...   8) ver. steerers indexes</span>
0021 <span class="comment">%     indQCor,...   9) normal quad. correctors indexes</span>
0022 <span class="comment">%     indSCor)     10) skew quad. correctors indexes</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% dispaly correction effect.</span>
0025 <span class="comment">%</span>
0026 
0027 compute_emittances=true;
0028 
0029 disp(<span class="string">' --- model lattice data --- '</span>)
0030 
0031 d0=<a href="#_sub1" class="code" title="subfunction a=getdatalattice(r0,inCOD,refpts,indHCor,indVCor,indCorQuads,indSCor,emitok)">getdatalattice</a>(r0,inCODe*0,refpts,indHCor,indVCor,indQCor,indSCor,compute_emittances);
0032 
0033 disp(<span class="string">' --- errors lattice data --- '</span>)
0034 de=<a href="#_sub1" class="code" title="subfunction a=getdatalattice(r0,inCOD,refpts,indHCor,indVCor,indCorQuads,indSCor,emitok)">getdatalattice</a>(rerr,inCODe,refpts,indHCor,indVCor,indQCor,indSCor,compute_emittances);
0035 
0036 disp(<span class="string">' --- corrected lattice data --- '</span>)
0037 dc=<a href="#_sub1" class="code" title="subfunction a=getdatalattice(r0,inCOD,refpts,indHCor,indVCor,indCorQuads,indSCor,emitok)">getdatalattice</a>(rcor,inCODc,refpts,indHCor,indVCor,indQCor,indSCor,compute_emittances);
0038 
0039 
0040 <span class="comment">% print out correction effect</span>
0041 oudataforma=<span class="string">'%3.2e'</span>;
0042 oudataformatune=<span class="string">'%2.3f'</span>;
0043 oudataformaemit=<span class="string">'%3.3f'</span>;
0044 oudataformabeta=<span class="string">'%2.1f'</span>;
0045 
0046 <span class="comment">%</span>
0047 disp(<span class="string">'--------------------------------------------------'</span>);
0048 disp(<span class="string">'------ total std corrector values applyed --------'</span>)
0049 disp(<span class="string">'------                                    --------'</span>);
0050 disp([<span class="string">'       HK ('</span> num2str(length(d0.ch)) <span class="string">') [1/m]: '</span> num2str(std(de.ch),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.ch),oudataforma) ]);
0051 disp([<span class="string">'       VK ('</span> num2str(length(d0.cv)) <span class="string">') [1/m]: '</span> num2str(std(de.cv),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.cv),oudataforma) ]);
0052 disp([<span class="string">'       SK ('</span> num2str(length(d0.cs)) <span class="string">') [1/m2]: '</span> num2str(std(de.cs),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.cs),oudataforma) ]);
0053 disp([<span class="string">'       QK ('</span> num2str(length(d0.cq)) <span class="string">') [1/m2]: '</span> num2str(std(de.cq-d0.cq),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.cq-d0.cq),oudataforma) ]);
0054 <span class="keyword">if</span> nargin==8
0055     ch=dc.ch.*d0.Lh;
0056     cv=dc.cv.*d0.Lv;
0057     cq=dc.cq.*d0.Lq;
0058     cs=dc.cs.*d0.Ls;
0059     che=de.ch.*d0.Lh;
0060     cve=de.cv.*d0.Lv;
0061     cqe=de.cq.*d0.Lq;
0062     cse=de.cs.*d0.Ls;
0063     disp([<span class="string">'       HKL ('</span> num2str(length(ch)) <span class="string">') [rad]: '</span> num2str(std(che),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(ch),oudataforma) ]);
0064     disp([<span class="string">'       VKL ('</span> num2str(length(cv)) <span class="string">') [rad]: '</span> num2str(std(cve),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(cv),oudataforma) ]);
0065     disp([<span class="string">'       SKL ('</span> num2str(length(cs)) <span class="string">') [1/m]: '</span> num2str(std(cse),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(cs),oudataforma) ]);
0066     disp([<span class="string">'       QKL ('</span> num2str(length(cq)) <span class="string">') [1/m]: '</span> num2str(std(cqe-d0.cq),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(cq-d0.cq),oudataforma) ]);
0067     
0068     Brho=getBrho(r0);
0069     
0070     ch=dc.ch.*d0.Lh.*Brho;
0071     cv=dc.cv.*d0.Lv.*Brho;
0072     cq=dc.cq.*d0.Lq.*Brho;
0073     cs=dc.cs.*d0.Ls.*Brho;
0074     che=de.ch.*d0.Lh.*Brho;
0075     cve=de.cv.*d0.Lv.*Brho;
0076     cqe=de.cq.*d0.Lq.*Brho;
0077     cse=de.cs.*d0.Ls.*Brho;
0078     disp([<span class="string">'       HKLBrho ('</span> num2str(length(ch)) <span class="string">') [Tm]: '</span> num2str(std(che),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(ch),oudataforma) ]);
0079     disp([<span class="string">'       VKLBrho ('</span> num2str(length(cv)) <span class="string">') [Tm]: '</span> num2str(std(cve),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(cv),oudataforma) ]);
0080     disp([<span class="string">'       SKLBrho ('</span> num2str(length(cs)) <span class="string">') [T]: '</span> num2str(std(cse),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(cs),oudataforma) ]);
0081     disp([<span class="string">'       QKLBrho ('</span> num2str(length(cq)) <span class="string">') [T]: '</span> num2str(std(cqe-d0.cq),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(cq-d0.cq),oudataforma) ]);
0082 <span class="keyword">end</span>
0083 disp(<span class="string">'------                                    --------'</span>);
0084 disp(<span class="string">'------    residual orbit and dispersion   --------'</span>)
0085 disp(<span class="string">'------                                    --------'</span>);
0086 disp([<span class="string">'       OH ('</span> num2str(length(d0.monh)) <span class="string">') [m]: '</span> num2str(std(de.monh),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.monh),oudataforma) ]);
0087 disp([<span class="string">'       OV ('</span> num2str(length(d0.monv)) <span class="string">') [m]: '</span> num2str(std(de.monv),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.monv),oudataforma) ]);
0088 disp([<span class="string">'       DH ('</span> num2str(length(d0.dish)) <span class="string">') [m]: '</span> num2str(std(de.dish-d0.dish),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.dish-d0.dish),oudataforma) ]);
0089 disp([<span class="string">'       DV ('</span> num2str(length(d0.disv)) <span class="string">') [m]:'</span> num2str(std(de.disv),oudataforma) <span class="string">' -&gt; '</span>  num2str(std(dc.disv),oudataforma) ]);
0090 disp([<span class="string">'       BBH ('</span> num2str(length(d0.bbh)) <span class="string">') %: '</span> num2str(std((de.bbh-d0.bbh)./d0.bbh)*100,oudataformabeta) <span class="string">' -&gt; '</span>  num2str(std((dc.bbh-d0.bbh)./d0.bbh)*100,oudataformabeta) ]);
0091 disp([<span class="string">'       BBV ('</span> num2str(length(d0.bbv)) <span class="string">') %: '</span> num2str(std((de.bbv-d0.bbv)./d0.bbv)*100,oudataformabeta) <span class="string">' -&gt; '</span>  num2str(std((dc.bbv-d0.bbv)./d0.bbv)*100,oudataformabeta) ]);
0092 disp([<span class="string">'       PhH ('</span> num2str(length(d0.mh)) <span class="string">') : '</span> num2str(std((de.mh-d0.mh)),oudataforma) <span class="string">' -&gt; '</span>  num2str(std((dc.mh-d0.mh)),oudataforma) ]);
0093 disp([<span class="string">'       PhV ('</span> num2str(length(d0.mv)) <span class="string">') : '</span> num2str(std((de.mv-d0.mv)),oudataforma) <span class="string">' -&gt; '</span>  num2str(std((dc.mv-d0.mv)),oudataforma) ]);
0094 disp(<span class="string">'------                                    --------'</span>);
0095 disp(<span class="string">'------        tune and emittance          --------'</span>)
0096 disp(<span class="string">'------                                    --------'</span>);
0097 disp([<span class="string">'       Qx ['</span> num2str(d0.tune(1),oudataformatune) <span class="string">']: '</span> num2str(de.tune(1),oudataformatune) <span class="string">' -&gt; '</span>  num2str(dc.tune(1),oudataformatune) ]);
0098 disp([<span class="string">'       Qy ['</span> num2str(d0.tune(2),oudataformatune) <span class="string">']: '</span> num2str(de.tune(2),oudataformatune) <span class="string">' -&gt; '</span>  num2str(dc.tune(2),oudataformatune) ]);
0099 disp([<span class="string">'       Cx ['</span> num2str(d0.crom(1),oudataformatune) <span class="string">']: '</span> num2str(de.crom(1),oudataformatune) <span class="string">' -&gt; '</span>  num2str(dc.crom(1),oudataformatune) ]);
0100 disp([<span class="string">'       Cy ['</span> num2str(d0.crom(2),oudataformatune) <span class="string">']: '</span> num2str(de.crom(2),oudataformatune) <span class="string">' -&gt; '</span>  num2str(dc.crom(2),oudataformatune) ]);
0101 <span class="keyword">if</span> compute_emittances
0102     disp([<span class="string">'       EX ['</span> num2str(d0.modemittance(1)*1e12,oudataformaemit) <span class="string">' pm]: '</span> num2str(de.modemittance(1)*1e12,oudataformaemit) <span class="string">' -&gt; '</span>  num2str(dc.modemittance(1)*1e12,oudataformaemit) ]);
0103     disp([<span class="string">'       EY ['</span> num2str(d0.modemittance(2)*1e12,oudataformaemit) <span class="string">'pm]: '</span> num2str(de.modemittance(2)*1e12,oudataformaemit) <span class="string">' -&gt; '</span>  num2str(dc.modemittance(2)*1e12,oudataformaemit) ]);
0104 <span class="keyword">end</span>
0105 disp(<span class="string">'------                                    --------'</span>);
0106 disp(<span class="string">'--------------------------------------------------'</span>);
0107 
0108 
0109 <span class="keyword">return</span>
0110 
0111 
0112 <a name="_sub1" href="#_subfunctions" class="code">function a=getdatalattice(r0,inCOD,refpts,indHCor,indVCor,indCorQuads,indSCor,emitok)</a>
0113 
0114 warning(<span class="string">'off'</span>,<span class="string">'all'</span>); <span class="comment">% mcf,atx, findorbit6,... generates warnings</span>
0115 
0116 alpha=mcf(r0);
0117 indrfc=find(atgetcells(r0,<span class="string">'Frequency'</span>));
0118             
0119 <span class="comment">% get initial orbit</span>
0120 o=findorbit6Err(r0,refpts,inCOD);
0121 a.monh=o(1,:);
0122 a.monv=o(3,:);
0123 d=finddispersion6Err(r0,refpts,indrfc,alpha,1e-4,inCOD);
0124 a.dish=d(1,:);
0125 a.disv=d(3,:);
0126 
0127 <span class="keyword">if</span> emitok
0128     <span class="keyword">try</span>
0129         [~,b0]=atx(r0,0,1:length(r0));
0130     <span class="keyword">catch</span> exc
0131         getReport(exc,<span class="string">'extended'</span>);
0132         warning(<span class="string">'atx failed'</span>);
0133         b0.modemittance=[NaN NaN];
0134         b0.fulltunes=[NaN NaN];
0135     <span class="keyword">end</span>
0136     
0137     a.tune=b0.fulltunes;
0138     a.modemittance= b0.modemittance;
0139 <span class="keyword">end</span>
0140 
0141 [l,t,a.crom]=atlinopt(r0,0,refpts);
0142 
0143 <span class="keyword">if</span> ~emitok
0144     a.tune=t;
0145 <span class="keyword">end</span>
0146 
0147 a.bbh=arrayfun(@(s)s.beta(1),l);
0148 a.bbv=arrayfun(@(s)s.beta(2),l);
0149 a.mh=arrayfun(@(s)s.mu(1),l);
0150 a.mv=arrayfun(@(s)s.mu(2),l);
0151 
0152 a.Lh=getcellstruct(r0,<span class="string">'Length'</span>,indHCor);
0153 a.Lv=getcellstruct(r0,<span class="string">'Length'</span>,indVCor);
0154 a.Lq=getcellstruct(r0,<span class="string">'Length'</span>,indCorQuads);
0155 a.Ls=getcellstruct(r0,<span class="string">'Length'</span>,indSCor);
0156 a.ch=getcellstruct(r0,<span class="string">'PolynomB'</span>,indHCor,1,1);
0157 a.cv=getcellstruct(r0,<span class="string">'PolynomA'</span>,indVCor,1,1);
0158 a.cq=getcellstruct(r0,<span class="string">'PolynomB'</span>,indCorQuads,1,2);
0159 a.cs=getcellstruct(r0,<span class="string">'PolynomA'</span>,indSCor,1,2);
0160 
0161 warning(<span class="string">'on'</span>,<span class="string">'all'</span>);
0162 
0163 <span class="keyword">return</span></pre></div>
<hr><address>Generated on Mon 05-Mar-2018 10:51:40 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>